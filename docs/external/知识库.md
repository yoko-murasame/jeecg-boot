[返回](../)

# 知识库

一个不断完善的文档管理系统。

![知识库-1694433536258.png](./assets/知识库-1694433536258.png)

* [SQL路径](https://github.com/yoko-murasame/jeecg-boot/blob/yoko-3.4.3last/db/增量SQL/3.4.3文件模块扩展.sql)
* [后端路径](https://github.com/yoko-murasame/jeecg-boot/blob/yoko-3.4.3last/jeecg-module-system/jeecg-system-start/src/main/java/org/jeecg/modules/technical)
* [前端路径](https://github.com/yoko-murasame/ant-design-vue-jeecg/blob/yoko/src/views/modules/knowledge)

## 使用

路由配置: 

```json
{
  "name": "知识库",
  "path": "/knowledge",
  "module": "modules/knowledge/Knowledge"
}
```

按钮权限-目录授权按钮:

```json
{
  "name": "知识库-目录-用户授权按钮",
  "perms": "KNOWLEDGE_FOLDER_USER_AUTH_BUTTON"
}
```

按钮权限-文件下载按钮:

```json
{
  "name": "知识库-文件-下载按钮",
  "perms": "KNOWLEDGE_FILE_DOWNLOAD_BUTTON"
}
```

数据权限-强制开放全目录及其文件查看权:

```json
{
  "name": "知识库-数据权限-全目录及其文件查看权限",
  "perms": "KNOWLEDGE_FOLDER_USER_FULL"
}
```

功能点:
* 任意层级的嵌套目录、基于前端JSON格式自动初始化目录
* 基于后端的严格文件格式限制
* 支持文件版本管理、文件恢复
* 双主键业务模式绑定
* 下载按钮授权，常见图片、视频、PDF预览时不提供下载；仅当系统存在下载授权按钮时，此功能生效。

## 按钮权限-显隐改禁用

默认基于`v-has`去控制按钮权限的显隐，如果需要换成禁用，这里以`FileList.vue`组件改造为例，参考下代码即可：
```vue
<template>
  <div>
    <a-table>
      <template slot="action" slot-scope="text, record">
        <!--仅当系统已配置此按钮权限时，才生效-->
        <template v-if="KNOWLEDGE_FILE_DOWNLOAD_BUTTON_FLAG">
          <a :disabled="isDisabledAuth(KNOWLEDGE_FILE_DOWNLOAD_BUTTON)" href="javascript:;" @click="handleDownload(record)">下载</a>
          <a-divider type="vertical"/>
          <a-dropdown>
            <a class="ant-dropdown-link">更多
              <a-icon type="down"/>
            </a>
            <a-menu slot="overlay">
              <a-menu-item :disabled="isDisabledAuth(KNOWLEDGE_FILE_DOWNLOAD_BUTTON)">
                <a-popconfirm :disabled="isDisabledAuth(KNOWLEDGE_FILE_DOWNLOAD_BUTTON)" title="确定删除吗?" @confirm="() => deleteFile(record.id)">
                  <a :disabled="isDisabledAuth(KNOWLEDGE_FILE_DOWNLOAD_BUTTON)">删除</a>
                </a-popconfirm>
              </a-menu-item>
            </a-menu>
          </a-dropdown>
        </template>
        <template v-else>
          <a href="javascript:;" @click="handleDownload(record)">下载</a>
          <a-divider type="vertical"/>
          <a-dropdown>
            <a class="ant-dropdown-link">更多
              <a-icon type="down"/>
            </a>
            <a-menu slot="overlay">
              <a-menu-item>
                <a-popconfirm title="确定删除吗?" @confirm="() => deleteFile(record.id)">
                  <a>删除</a>
                </a-popconfirm>
              </a-menu-item>
            </a-menu>
          </a-dropdown>
        </template>
      </template>
    </a-table>
  </div>
</template>
<script>
import { mapState } from 'vuex'
import { DisabledAuthFilterMixin } from '@/mixins/DisabledAuthFilterMixin'

export default {
  mixins: [DisabledAuthFilterMixin],
  computed: {
    ...mapState({
      KNOWLEDGE_FILE_DOWNLOAD_BUTTON: state => state.permission.KNOWLEDGE_FILE_DOWNLOAD_BUTTON,
      KNOWLEDGE_FILE_DOWNLOAD_BUTTON_FLAG: state => state.permission.KNOWLEDGE_FILE_DOWNLOAD_BUTTON_FLAG
    })
  }
}
</script>
```

## 修改历史

* 2023-09-11: 新增知识库模块。
* 2023-10-21: 知识库模块-根目录、子目录相关-增删改功能BUG测试、修复
* 2023-10-21: 知识库模块-实现文件标签功能、标签添加、多标签异步搜索、标签高亮、文件重命名等功能。
* 2023-10-23: 知识库-大面积重构代码、精简优化逻辑，添加删除目录后自动回选父目录、增删改查目录后自动递归更新目录信息、上传文件后自动递归更新目录信息、高亮存在子目录&子文件的目录节点等功能。
* 2023-10-23: 知识库-重构文件列表模块用以复用&问题处理、调整目录树列表样式、添加搜索结果多结果微微高亮效果
* 2023-11-02: 知识库-实现目录、文件按个人角色授权功能
* 2023-11-23: 知识库-实现下载按钮授权，常见图片、视频、PDF预览时不提供下载；仅当系统存在下载授权按钮时，此功能生效。

# 归档

## 权限列表接口

```sql
-- 开发权限列表接口
WITH perm AS (SELECT *
              FROM technical_folder_user_permission
              WHERE username = 'yoko'),
     folder AS (SELECT id,
                       create_by,
                       create_time,
                       update_by,
                       update_time,
                       name,
                       level,
                       folder_order,
                       parent_id,
                       project_id,
                       project_name,
                       child_folder_size,
                       type,
                       child_file_size,
                       enabled,
                       business_id,
                       business_name,
                       tags
                FROM technical_folder)
SELECT folder.*, perm.username, perm.data_permission_type
FROM folder INNER JOIN perm ON folder.id = perm.folder_id
```
